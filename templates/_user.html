<div id="user-{{ user.steamid }}" class="user-card">
  <h2>
    <a href="{{ user.profile }}" target="_blank">
      <img src="{{ user.avatar }}" width="64" style="vertical-align: middle; border-radius: 8px;">
    </a>
    {{ user.username }}
    <span class="tf2-hours">TF2 Playtime: {{ user.playtime }} hrs</span>
    <span class="pill status-pill {{ user.status }}{% if user.status == 'failed' %} retry-pill{% endif %}" {% if user.status == 'failed' %}data-steamid="{{ user.steamid }}" title="Retry scan for this user"{% endif %}>
      {% if user.status == 'parsed' %}
        <i class="fa-solid fa-check"></i> Public
      {% elif user.status == 'private' %}
        <i class="fa-solid fa-lock"></i> Private
      {% else %}
        <i class="fa-solid fa-arrows-rotate"></i> Failed
      {% endif %}
    </span>
  </h2>
  <div class="card-body">
    {% if user.status == 'incomplete' %}
      <span class="badge bg-warning text-dark">Fetched but unparsed</span>
    {% elif user.status == 'private' %}
      <span class="badge bg-secondary">Private</span>
    {% endif %}
    <div class="inventory-scroll">
      <button class="scroll-arrow left" type="button" aria-label="Scroll left">
        <i class="fa-solid fa-chevron-left"></i>
      </button>
      <div class="inventory-container">
        {% for item in user.items %}
          <div
            class="item-card"
            style="border-color: {{ item.quality_color }};"
            data-item='{{ item | tojson | safe }}'
          >
            {% if item.paint_hex %}
              <span class="paint-dot" style="background:{{ item.paint_hex }}"></span>
            {% endif %}
            {% if item.killstreak_tier %}
              <span class="ks-mark ks-tier-{{ item.killstreak_tier }}"></span>
            {% endif %}
            {% if item.final_url %}
              <img class="item-img" src="{{ item.final_url }}" alt="{{ item.name }}" width="64" height="64" onerror="this.style.display='none';">
            {% else %}
              <div class="missing-icon"></div>
            {% endif %}
            <div class="item-name">{{ item.name }}</div>
            <div class="badge-bar">
              {% for badge in item.badges %}
                <div class="badge" title="{{ badge.title }}">
                  {% if badge.icon.startswith('#') %}
                    <span class="paint-dot" style="background:{{ badge.icon }}"></span>
                  {% else %}
                    {{ badge.icon }}
                  {% endif %}
                </div>
              {% endfor %}
            </div>
            {% set e = item.enriched if item.enriched is defined else {} %}
            <div class="enrichment-debug">
              {% if e.killstreak_tier %}
                Killstreak: {{ e.killstreak_tier }}<br>
              {% endif %}
              {% if e.spells %}
                Spells: {{ e.spells | join(', ') }}<br>
              {% endif %}
              {% if e.strange_parts %}
                Strange Parts: {{ e.strange_parts | join(', ') }}<br>
              {% endif %}
              {% if e.paint_name %}
                Paint: {{ e.paint_name }}
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
      <button class="scroll-arrow right" type="button" aria-label="Scroll right">
        <i class="fa-solid fa-chevron-right"></i>
      </button>
    </div>
  </div>
  <div class="item-modal">
    <div class="modal-bg"></div>
    <div class="modal-content">
      <button type="button" class="modal-close">❌</button>
      <dl class="modal-details"></dl>
    </div>
  </div>
</div>
