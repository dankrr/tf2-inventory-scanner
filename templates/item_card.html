{# --- Precompute the full display title used by the modal --- #} {% set
title_parts = [] %} {% if item.killstreak_name %} {% if item.killstreak_name ==
'Killstreak' %} {% set _ = title_parts.append('Killstreak') %} {% else %} {% set
_ = title_parts.append(item.killstreak_name) %} {% set _ =
title_parts.append('Killstreak') %} {% endif %} {% endif %} {% set quality =
item.quality %} {% if not item.is_australium %} {% if quality == 'Strange' %} {%
set _ = title_parts.append('Strange') %} {% elif quality and quality not in
('Unique', 'Normal', 'Decorated Weapon') %} {% if not (quality == 'Unusual' and
item.unusual_effect_id) %} {% set _ = title_parts.append(quality) %} {% endif %}
{% endif %} {% endif %} {% if item.is_war_paint_tool %} {% if
item.target_weapon_name %} {% set base = (item.warpaint_name ~ ' ' ~
item.target_weapon_name) %} {% else %} {% set base = item.warpaint_name or
item.display_name %} {% endif %} {% elif item.unusual_effect_id %} {% set base =
item.display_name %} {% else %} {% set base = item.composite_name or
item.base_name or item.display_name or item.name %} {% endif %} {% if
item.is_australium %} {% set base = 'Australium ' ~ base %} {% endif %} {% set
full_title = (title_parts + [base]) | join(' ') %}

<!-- prettier-ignore -->
{# --- Derive an alternate quality color for dual-quality borders --- #}
{# Direct field if backend provides it #}
{% set alt_q =
     item.alt_quality_color
  or item.secondary_quality_color
  or item.quality2_color
  or (item.multi_quality_colors[1] if item.multi_quality_colors is defined and (item.multi_quality_colors|length) > 1 else None)
%}
{# Heuristics for common combos if no explicit alt provided #}
{% if not alt_q %}
  {% set qcolor = {
    'Strange':  '#CF6A32',
    'Unusual':  '#8650AC',
    'Genuine':  '#4D7455',
    'Vintage':  '#476291',
    'Haunted':  '#38F3AB'
  } %}
  {% set primary_name = item.quality %}
  {# Strange + Unusual #}
  {% if item.unusual_effect_id and primary_name != 'Unusual' %}
    {% set alt_q = qcolor['Unusual'] %}
  {% endif %}
  {# Strange + Genuine (or similar secondary tag) #}
  {% if not alt_q and (item.is_genuine or (item.quality2 is defined and item.quality2 == 'Genuine')) and primary_name != 'Genuine' %}
    {% set alt_q = qcolor['Genuine'] %}
  {% endif %}
  {# Unusual item whose primary is Unusual but also Strange #}
  {% if not alt_q and item.has_strange_tracking and primary_name != 'Strange' %}
    {% set alt_q = qcolor['Strange'] %}
  {% endif %}
{% endif %}

<div
  class="item-card{% if item.untradable_hold %} trade-hold{% endif %}{% if item.uncraftable %} uncraftable{% endif %}{% if item.has_strange_tracking %} elevated-strange{% endif %}{% if alt_q %} has-dual-quality{% endif %}"
  style="--quality-color: {{ item.quality_color }};{% if alt_q %} --quality-alt: {{ alt_q }};{% endif %} border-color: {{ item.border_color or item.quality_color }};"
  title="{{ full_title }}"
  {%
  if
  alt_q
  %}data-dual="1"
  {%
  endif
  %}
  data-item="{{ item|tojson|forceescape }}"
  data-craftable="{{ 'true' if item.craftable else 'false' }}"
>
  <div class="item-badges">
    {% if item.is_australium %}
    <img
      src="/static/images/logos/australium.png"
      class="australium-icon"
      alt="Australium"
    />
    {% endif %} {% if item.paint_hex %}
    <span
      class="paint-dot"
      style="background-color: {{ item.paint_hex }};"
      title="Paint: {{ item.paint_name }}"
    ></span>
    {% endif %} {# Festivized indicator (derived on backend for reliability) #}
    {% if item.is_festivized %}
    <span class="badge festive" title="Festivized" aria-label="Festivized">
      <i class="fa-regular fa-lightbulb"></i>
    </span>
    {% endif %} {% for badge in item.badges %} {# Avoid duplicate festive
    indicators from any upstream badges #} {% if badge.type != 'festivized' and
    badge.icon != 'ðŸ’¡' %} {% if badge.type != 'statclock' and badge.icon != 'ðŸŽ¨'
    %} {% if badge.type == 'killstreak' %}
    <span class="badge" data-icon="{{ badge.icon }}" title="{{ badge.title }}">
      <span
        class="chevron-icon"
        {%
        if
        item.sheen_gradient_css
        %}
        style="{{ item.sheen_gradient_css }}; -webkit-background-clip: text; background-clip: text; color: transparent;"
        {%
        elif
        item.sheen_color
        %}
        style="color: {{ item.sheen_color }};"
        {%
        endif
        %}
        >{{ badge.icon }}</span
      >
    </span>
    {% elif badge.icon_url %}
    <img
      src="{{ badge.icon_url }}"
      class="badge-icon"
      alt=""
      title="{{ badge.title }}"
    />
    {% else %}
    <span
      class="badge"
      data-icon="{{ badge.icon }}"
      {%
      if
      badge.color
      %}
      style="color:{{ badge.color }}"
      {%
      endif
      %}
      title="{{ badge.title }}"
      >{{ badge.icon }}</span
    >
    {% endif %} {% endif %} {% endif %} {% endfor %}
  </div>
  {% if item.quantity and item.quantity > 1 %}
  <span class="item-qty">x{{ item.quantity }}</span>
  {% endif %} {% if item.statclock_badge %}
  <img
    src="{{ item.statclock_badge }}"
    class="statclock-badge"
    alt="StatTrakâ„¢"
    title="StatTrakâ„¢ Active"
  />
  {% endif %}
  <div class="item-media">
    {% if item.unusual_effect_id %}
    <img
      class="particle-bg"
      loading="lazy"
      src="/static/images/effects/{{ item.unusual_effect_id }}.png"
      data-src="/static/images/effects/{{ item.unusual_effect_id }}.png"
      alt=""
      aria-hidden="true"
      onerror="this.remove()"
    />
    {% endif %} {% if item.target_weapon_image %}
    <div class="kit-composite">
      <img
        class="kit-bg"
        src="{{ item.image_url }}"
        loading="lazy"
        width="96"
        height="96"
        alt="{{ item.display_name }}"
      />
      <img
        class="kit-weapon-overlay"
        src="{{ item.target_weapon_image }}"
        loading="lazy"
        alt="overlay"
      />
    </div>
    {% elif item.image_url %}
    <img
      class="item-img"
      loading="lazy"
      src="{{ item.image_url }}"
      data-src="{{ item.image_url }}"
      alt="{{ item.display_name }}"
      width="64"
      height="64"
      onerror="this.style.display='none';"
    />
    {% else %}
    <div class="missing-icon"></div>
    {% endif %}
  </div>
  {# Title is shown as tooltip via the title attribute above; no inline name
  row. #}
</div>
