# Functions Reference

| Function                             | Purpose                                                                                                       | Parameters                                                                         | Returns         | Used In                               |
| ------------------------------------ | ------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------- | --------------- | ------------------------------------- |
| `addCardToBucket(card, containerId)` | Append a user card to a target bucket, keeping public cards before private ones and managing scroll behavior. | `card` (HTMLElement) – rendered card; `containerId` (string) – target container ID | `void`          | `static/submit.js`, `static/retry.js` |
| `fetchUserCard(id)`                  | Fetch a single user card from the server and append it to the correct bucket.                                 | `id` (string) – Steam identifier                                                   | `Promise<void>` | `static/submit.js`                    |
| `handleItemClick(event)`             | Display the item modal using data embedded on the card, logging malformed payloads.                           | `event` (MouseEvent \| HTMLElement) – click event or card element                  | `void`          | `static/retry.js`                     |
| `handleSubmit(e)`                    | Process form submission and launch parallel scans.                                                            | `e` (SubmitEvent) – form event                                                     | `void`          | `static/submit.js`                    |
| `retryInventory(id)`                 | Retry a failed scan and append the updated card to the proper bucket.                                         | `id` (string) – Steam identifier                                                   | `Promise<void>` | `static/retry.js`                     |
| `refreshAll()`                       | Batch retry all failed scans with progress feedback.                                                          | –                                                                                  | `Promise<void>` | `static/retry.js`                     |
| `attachItemModal()`                  | Delegate modal click handling from result containers and attach effect fallback.                              | –                                                                                  | `void`          | `static/retry.js`                     |
| `attachEffectFallback()`             | Remove particle effect images if their source fails to load.                                                  | –                                                                                  | `void`          | `static/retry.js`                     |
| `attachHandlers()`                   | Attach click handlers, modal logic, and search bindings to current cards.                                     | –                                                                                  | `void`          | `static/retry.js`                     |
| `attachUserSearch()`                 | Bind per-user inventory search, caching item names and supporting legacy/new layouts.                         | –                                                                                  | `void`          | `static/retry.js`                     |
| `applyStoredPreferences()`           | Load and apply saved UI display preferences.                                                                  | –                                                                                  | `void`          | `static/ui.js`                        |
| `updateToggleButtons()`              | Reflect active UI modes on global toggle buttons, updating aria-pressed and titles for accessibility.         | –                                                                                  | `void`          | `static/ui.js`                        |
| `toggleCompactMode()`                | Toggle compact density mode and persist preference.                                                           | –                                                                                  | `void`          | `static/ui.js`                        |
| `toggleBorderMode()`                 | Toggle border-only quality mode, persist preference, and refresh item card rings.                             | –                                                                                  | `void`          | `static/ui.js`                        |
| `handleUserSearch(event)`            | Filter a user's items by name from the search box.                                                            | `event` (Event) – input event from search box                                      | `void`          | `static/ui.js`                        |
| `attachUserFeatures()`               | Bind search handlers to user cards; used after DOM updates.                                                   | –                                                                                  | `void`          | `static/ui.js`                        |
| `initUI()`                           | Initialize global toggles and per-user search on page load.                                                   | –                                                                                  | `void`          | `static/ui.js`                        |
| `updateRefreshButton()`              | Enable or disable refresh buttons and toggle floating control.                                                | –                                                                                  | `void`          | `static/retry.js`                     |
| `setupFloatingControls()`            | Bind scroll-to-top and floating refresh buttons.                                                              | –                                                                                  | `void`          | `static/retry.js`                     |
| `updateSettingsMenuState()`          | Reflect body compact/border classes on settings menu buttons.                                                 | –                                                                                  | `void`          | `static/ui.js`                        |
| `hideLegacyDisplayToggles()`         | Hide legacy display toggles by known selectors with a final text-based safety net.                            | –                                                                                  | `void`          | `static/ui.js`                        |
| `setFAIcons()`                       | Inject Font Awesome gear, Compact, and Border Mode icons if missing.                                          | –                                                                                  | `void`          | `static/ui.js`                        |
| `syncSettingsIconsFromLegacy()`      | Copy legacy header icons into the settings menu when Font Awesome icons are absent.                           | –                                                                                  | `void`          | `static/ui.js`                        |
| `setupSettingsFab()`                 | Initialize floating settings FAB, sync menu state, and mirror legacy icons.                                   | –                                                                                  | `void`          | `static/ui.js`                        |
| `focusSteamInput()`                  | Focus and select the Steam IDs textarea so it is ready for paste on load.                                     | –                                                                                  | `void`          | `static/retry.js`                     |

### Newly Added

| Function                                 | Purpose                                                                  | Parameters                                                                 | Returns                                | Used In           |
| ---------------------------------------- | ------------------------------------------------------------------------ | -------------------------------------------------------------------------- | -------------------------------------- | ----------------- |
| `getCompletedUsers()`                    | Count user cards in the Completed bucket.                                | –                                                                          | `number`                               | `static/retry.js` |
| `toggleCompletedBucket(completedCount)`  | Hide or show the Completed results bucket when empty.                    | `completedCount` (number) – count of completed cards                       | `void`                                 | `static/retry.js` |
| `updateBucketVisibility()`               | Toggle visibility for Completed and Failed buckets.                      | –                                                                          | `void`                                 | `static/retry.js` |
| `toggleFailedBucket(failures)`           | Hide or show the Failed results bucket when empty.                       | `failures` (number) – count of failed cards                                | `void`                                 | `static/retry.js` |
| `safeParseItem(card)`                    | Safely parse item data embedded on a card.                               | `card` (HTMLElement) – item card element                                   | `Object`                               | `static/ui.js`    |
| `rememberBaseQuality(card)`              | Preserve the server-provided item quality for palette calculations.      | `card` (HTMLElement) – item card element                                   | `void`                                 | `static/ui.js`    |
| `pickTwoByPrecedence(candidates)`        | Select up to two qualities based on precedence.                          | `candidates` (string[]) – quality names                                    | `string[]`                             | `static/ui.js`    |
| `computeQualities(card)`                 | Determine primary and secondary qualities from card data.                | `card` (HTMLElement) – item card element                                   | `{primary: string, secondary: string}` | `static/ui.js`    |
| `applyQualityPalette(scope)`             | Paint palette colors on item cards in normal mode.                       | `scope` (ParentNode) – DOM scope (default `document`)                      | `void`                                 | `static/ui.js`    |
| `applyBorderModeToCards(enabled, scope)` | Apply single or dual-color rings to item cards when Border Mode toggles. | `enabled` (boolean) – Border Mode active; `scope` (ParentNode) – DOM scope | `void`                                 | `static/ui.js`    |

### Backend

| Function                                    | Purpose                                                                       | Parameters                                                        | Returns           | Used In  |
| ------------------------------------------- | ----------------------------------------------------------------------------- | ----------------------------------------------------------------- | ----------------- | -------- |
| `_make_failed_user_stub(steamid64, reason)` | Build a minimal failed user payload when upstream data is missing.            | `steamid64` (str) – user ID; `reason` (str) – failure description | `dict`            | `app.py` |
| `normalize_user_payload(user)`              | Coerce missing or invalid payloads into failed stubs and ensure an item list. | `user` (dict \| None) – raw user payload                          | `SimpleNamespace` | `app.py` |
| `fetch_and_process_single_user(steamid64)`  | Fetch user data, stub failures, and render HTML for one user.                 | `steamid64` (int) – SteamID64                                     | `str` (HTML)      | `app.py` |

_Updated_: `updateRefreshButton()` now calls `updateBucketVisibility()` to hide empty buckets.
