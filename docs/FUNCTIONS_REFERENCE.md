# Functions Reference

| Function                                 | Purpose                                                                                                       | Parameters                                                                         | Returns         | Used In                               |
| ---------------------------------------- | ------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------- | --------------- | ------------------------------------- |
| `addCardToBucket(card, containerId)`     | Append a user card to a target bucket, keeping public cards before private ones and managing scroll behavior. | `card` (HTMLElement) – rendered card; `containerId` (string) – target container ID | `void`          | `static/submit.js`, `static/retry.js` |
| `fetchUserCard(id)`                      | Fetch a single user card from the server and append it to the correct bucket.                                 | `id` (string) – Steam identifier                                                   | `Promise<void>` | `static/submit.js`                    |
| `handleItemClick(event)`                 | Display the item modal using data embedded on the card, logging malformed payloads.                           | `event` (MouseEvent \| HTMLElement) – click event or card element                  | `void`          | `static/retry.js`                     |
| `appendFestivizedToModal(modalEl, item)` | Append a compact 'Festivized' row to modal details before History when applicable.                            | `modalEl` (HTMLElement) – modal container; `item` (object) – item data             | `void`          | `static/retry.js`                     |
| `handleSubmit(e)`                        | Process form submission, show the scan toast, and launch parallel scans.                                      | `e` (SubmitEvent) – form event                                                     | `Promise<void>` | `static/submit.js`                    |
| `retryInventory(id)`                     | Retry a failed scan and append the updated card to the proper bucket.                                         | `id` (string) – Steam identifier                                                   | `Promise<void>` | `static/retry.js`                     |
| `refreshAll()`                           | Batch retry all failed scans with progress feedback.                                                          | –                                                                                  | `Promise<void>` | `static/retry.js`                     |
| `attachItemModal()`                      | Delegate modal click handling from result containers and attach effect fallback.                              | –                                                                                  | `void`          | `static/retry.js`                     |
| `attachEffectFallback()`                 | Remove particle effect images if their source fails to load.                                                  | –                                                                                  | `void`          | `static/retry.js`                     |
| `attachHandlers()`                       | Attach click handlers, modal logic, and search bindings to current cards.                                     | –                                                                                  | `void`          | `static/retry.js`                     |
| `attachUserSearch()`                     | Bind per-user inventory search, caching item names and supporting legacy/new layouts.                         | –                                                                                  | `void`          | `static/retry.js`                     |
| `applyStoredPreferences()`               | Load and apply saved UI display preferences.                                                                  | –                                                                                  | `void`          | `static/ui.js`                        |
| `updateToggleButtons()`                  | Reflect active UI modes on global toggle buttons, updating aria-pressed and titles for accessibility.         | –                                                                                  | `void`          | `static/ui.js`                        |
| `toggleCompactMode()`                    | Toggle compact density mode and persist preference.                                                           | –                                                                                  | `void`          | `static/ui.js`                        |
| `toggleBorderMode()`                     | Toggle border-only quality mode and persist preference.                                                       | –                                                                                  | `void`          | `static/ui.js`                        |
| `handleUserSearch(event)`                | Filter a user's items by name from the search box.                                                            | `event` (Event) – input event from search box                                      | `void`          | `static/ui.js`                        |
| `attachUserFeatures()`                   | Bind search handlers to user cards; used after DOM updates.                                                   | –                                                                                  | `void`          | `static/ui.js`                        |
| `initUI()`                               | Initialize global toggles and per-user search on page load.                                                   | –                                                                                  | `void`          | `static/ui.js`                        |
| `updateRefreshButton()`                  | Enable or disable refresh buttons and toggle floating control.                                                | –                                                                                  | `void`          | `static/retry.js`                     |
| `setupFloatingControls()`                | Bind scroll-to-top and floating refresh buttons.                                                              | –                                                                                  | `void`          | `static/retry.js`                     |
| `updateSettingsMenuState()`              | Reflect body compact/border classes on settings menu buttons.                                                 | –                                                                                  | `void`          | `static/ui.js`                        |
| `hideLegacyDisplayToggles()`             | Hide legacy display toggles by known selectors with a final text-based safety net.                            | –                                                                                  | `void`          | `static/ui.js`                        |
| `setFAIcons()`                           | Inject Font Awesome gear, Compact, and Border Mode icons if missing.                                          | –                                                                                  | `void`          | `static/ui.js`                        |
| `syncSettingsIconsFromLegacy()`          | Copy legacy header icons into the settings menu when Font Awesome icons are absent.                           | –                                                                                  | `void`          | `static/ui.js`                        |
| `setupSettingsFab()`                     | Initialize floating settings FAB, sync menu state, and mirror legacy icons.                                   | –                                                                                  | `void`          | `static/ui.js`                        |
| `focusSteamInput()`                      | Focus and select the Steam IDs textarea so it is ready for paste on load.                                     | –                                                                                  | `void`          | `static/retry.js`                     |

### Newly Added

| Function                                | Purpose                                               | Parameters                                                        | Returns  | Used In           |
| --------------------------------------- | ----------------------------------------------------- | ----------------------------------------------------------------- | -------- | ----------------- |
| `getCompletedUsers()`                   | Count user cards in the Completed bucket.             | –                                                                 | `number` | `static/retry.js` |
| `toggleCompletedBucket(completedCount)` | Hide or show the Completed results bucket when empty. | `completedCount` (number) – count of completed cards              | `void`   | `static/retry.js` |
| `updateBucketVisibility()`              | Toggle visibility for Completed and Failed buckets.   | –                                                                 | `void`   | `static/retry.js` |
| `toggleFailedBucket(failures)`          | Hide or show the Failed results bucket when empty.    | `failures` (number) – count of failed cards                       | `void`   | `static/retry.js` |
| `updateScanToast(current, total)`       | Display scanning progress with a rotating spinner.    | `current` (number) – current scan; `total` (number) – total scans | `void`   | `static/retry.js` |
| `hideScanToast()`                       | Hide the scan progress toast after scans finish.      | –                                                                 | `void`   | `static/retry.js` |

_Updated_: `updateRefreshButton()` now calls `updateBucketVisibility()` to hide empty buckets.

### Backend Utilities

| Function                         | Purpose                                                               | Parameters                           | Returns                       | Used In                        |
| -------------------------------- | --------------------------------------------------------------------- | ------------------------------------ | ----------------------------- | ------------------------------ |
| `_attributes_iter(attrs)`        | Safely iterate a maybe-missing, maybe-non-list attributes collection. | `attrs` (Any) – attributes structure | `Iterable[Mapping[str, Any]]` | `utils/schema_provider.py`     |
| `has_attribute(attrs, defindex)` | True if any attribute has the given defindex.                         | `attrs` (Any); `defindex` (int)      | `bool`                        | `utils/schema_provider.py`     |
| `is_festivized(attrs)`           | Detects Festivized weapons by attribute 2053.                         | `attrs` (Any)                        | `bool`                        | `utils/inventory_processor.py` |

### Inventory Processing

| Function                                       | Purpose                                                     | Parameters                                                   | Returns                                                   | Used In                                            |
| ---------------------------------------------- | ----------------------------------------------------------- | ------------------------------------------------------------ | --------------------------------------------------------- | -------------------------------------------------- |
| `refresh_attr_classes()`                       | Populate cached attribute-class sets from schema data.      | –                                                            | `None`                                                    | `utils/inventory/extract_attr_classes.py`          |
| `get_attr_class(idx)`                          | Look up the attribute class string for a defindex.          | `idx` (Any) – attribute defindex                             | `str \| None`                                             | `utils/inventory/extract_attr_classes.py`          |
| `_extract_unusual_effect(asset)`               | Parse Unusual particle effects from item attributes.        | `asset` (dict) – raw item                                    | `dict \| None`                                            | `utils/inventory/extractors_unusual_killstreak.py` |
| `_extract_killstreak_tier(asset)`              | Resolve killstreak tier id.                                 | `asset` (dict) – raw item                                    | `int \| None`                                             | `utils/inventory/extractors_unusual_killstreak.py` |
| `_extract_killstreak(asset)`                   | Return killstreak tier name, sheen name and id.             | `asset` (dict) – raw item                                    | `(str\|None, str\|None, int\|None)`                       | `utils/inventory/extractors_unusual_killstreak.py` |
| `_extract_killstreak_effect(asset)`            | Resolve killstreaker effect name.                           | `asset` (dict) – raw item                                    | `str \| None`                                             | `utils/inventory/extractors_unusual_killstreak.py` |
| `_compute_sheen_colors(sheen_id)`              | Compute sheen color list including Team Shine gradients.    | `sheen_id` (int\|None)                                       | `list[str]`                                               | `utils/inventory/extractors_unusual_killstreak.py` |
| `_extract_paint(asset)`                        | Detect applied paint name and color.                        | `asset` (dict) – raw item                                    | `(str\|None, str\|None)`                                  | `utils/inventory/extractors_paint_and_wear.py`     |
| `_extract_wear(asset)`                         | Determine wear tier name.                                   | `asset` (dict) – raw item                                    | `str \| None`                                             | `utils/inventory/extractors_paint_and_wear.py`     |
| `_extract_wear_float(asset)`                   | Extract exact wear float value.                             | `asset` (dict) – raw item                                    | `float \| None`                                           | `utils/inventory/extractors_paint_and_wear.py`     |
| `_extract_pattern_seed(asset)`                 | Read pattern seed from attributes.                          | `asset` (dict) – raw item                                    | `int \| None`                                             | `utils/inventory/extractors_paint_and_wear.py`     |
| `_slug_to_paintkit_name(slug)`                 | Humanize schema paintkit slugs.                             | `slug` (str) – schema slug                                   | `str`                                                     | `utils/inventory/extractors_paint_and_wear.py`     |
| `_extract_paintkit(asset, schema_entry)`       | Resolve paintkit id and name.                               | `asset` (dict); `schema_entry` (dict)                        | `(int\|None, str\|None)`                                  | `utils/inventory/extractors_paint_and_wear.py`     |
| `_extract_crate_series(asset)`                 | Detect crate series name.                                   | `asset` (dict) – raw item                                    | `str \| None`                                             | `utils/inventory/extractors_misc.py`               |
| `_extract_australium(asset)`                   | Check if asset has Australium attribute.                    | `asset` (dict) – raw item                                    | `bool`                                                    | `utils/inventory/extractors_misc.py`               |
| `_spell_icon(name)`                            | Map spell name to emoji icon.                               | `name` (str) – spell name                                    | `str`                                                     | `utils/inventory/extractors_misc.py`               |
| `_extract_spells(asset)`                       | Gather spell badges and names.                              | `asset` (dict) – raw item                                    | `(list[dict], list[str])`                                 | `utils/inventory/extractors_misc.py`               |
| `_extract_strange_parts(asset)`                | List Strange Part names on item.                            | `asset` (dict) – raw item                                    | `list[str]`                                               | `utils/inventory/extractors_misc.py`               |
| `_extract_kill_eater_info(asset)`              | Map kill-eater counts and score types.                      | `asset` (dict) – raw item                                    | `(dict[int,int], dict[int,int])`                          | `utils/inventory/extractors_misc.py`               |
| `_trade_hold_timestamp(asset)`                 | Read temporary trade hold timestamp.                        | `asset` (dict) – raw item                                    | `int \| None`                                             | `utils/inventory/extractors_misc.py`               |
| `_has_trade_hold(asset)`                       | True if item has a trade hold.                              | `asset` (dict) – raw item                                    | `bool`                                                    | `utils/inventory/extractors_misc.py`               |
| `_is_warpaint_tool(schema_entry)`              | Identify warpaint tool schema entries.                      | `schema_entry` (dict)                                        | `bool`                                                    | `utils/inventory/tools_and_kits.py`                |
| `_extract_warpaint_tool_info(asset)`           | Parse paintkit, wear and target weapon from warpaint tools. | `asset` (dict) – raw item                                    | `(int\|None, str\|None, str\|None, int\|None, str\|None)` | `utils/inventory/tools_and_kits.py`                |
| `_extract_killstreak_tool_info(asset)`         | Parse killstreak kit/fabricator details.                    | `asset` (dict) – raw item                                    | `dict \| None`                                            | `utils/inventory/tools_and_kits.py`                |
| `_is_warpaintable(schema_entry)`               | Determine if a weapon can be warpainted.                    | `schema_entry` (dict)                                        | `bool`                                                    | `utils/inventory/naming_and_warpaint.py`           |
| `_preferred_base_name(defindex, schema_entry)` | Human-readable base item name.                              | `defindex` (str); `schema_entry` (dict)                      | `str`                                                     | `utils/inventory/naming_and_warpaint.py`           |
| `_is_placeholder_name(name)`                   | Detect internal placeholder item names.                     | `name` (str)                                                 | `bool`                                                    | `utils/inventory/naming_and_warpaint.py`           |
| `_build_item_name(base, quality, asset)`       | Construct item display name with quality/killstreak data.   | `base` (str); `quality` (str); `asset` (dict)                | `str`                                                     | `utils/inventory/naming_and_warpaint.py`           |
| `_is_plain_craft_weapon(asset, schema_entry)`  | Filter out plain craft weapons lacking special attributes.  | `asset` (dict); `schema_entry` (dict)                        | `bool`                                                    | `utils/inventory/filters_and_rules.py`             |
| `_has_attr(asset, idx)`                        | True if asset has attribute with given defindex.            | `asset` (dict); `idx` (int)                                  | `bool`                                                    | `utils/inventory/filters_and_rules.py`             |
| `_process_item(asset, valuation_service)`      | Enrich a single inventory item with schema and price data.  | `asset` (dict); `valuation_service` (ValuationService\|None) | `dict \| None`                                            | `utils/inventory/processor.py`                     |
| `enrich_inventory(data, valuation_service)`    | Enrich raw inventory payload into item list.                | `data` (dict); `valuation_service` (ValuationService\|None)  | `list[dict]`                                              | `utils/inventory/api.py`                           |
| `process_inventory(data, valuation_service)`   | Enrich and sort items by price.                             | `data` (dict); `valuation_service` (ValuationService\|None)  | `list[dict]`                                              | `utils/inventory/api.py`                           |
| `run_enrichment_test(path)`                    | Load local JSON and print enriched items (debug).           | `path` (str\|None)                                           | `None`                                                    | `utils/inventory/api.py`                           |
